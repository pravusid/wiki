(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{500:function(e,t,s){"use strict";s.r(t);var a=s(27),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"let-s-encrypt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt"}},[e._v("#")]),e._v(" Let's Encrypt")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://letsencrypt.org/docs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://letsencrypt.org/docs/"),s("OutboundLink")],1)]),e._v(" "),s("blockquote",[s("p",[e._v("Let’s Encrypt is a free, automated, and open Certificate Authority")])]),e._v(" "),s("p",[e._v("Let's Encrypt 인증서는 3개월의 유효기간을 갖고 있으며, 자동 발급/갱신을 도와주는 "),s("code",[e._v("acme.sh")]),e._v(" or "),s("code",[e._v("certbot")]),e._v(" 사용")]),e._v(" "),s("h2",{attrs:{id:"인증서"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#인증서"}},[e._v("#")]),e._v(" 인증서")]),e._v(" "),s("p",[e._v("발급 과정을 거치면 다음 인증서가 생성됨")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("privkey.pem")]),e._v(" : 인증서 개인키")]),e._v(" "),s("li",[s("code",[e._v("cert.pem")]),e._v(" : 도메인 인증서")]),e._v(" "),s("li",[s("code",[e._v("chain.pem")]),e._v(" : Let’s Encrypt chain 인증서")]),e._v(" "),s("li",[s("code",[e._v("fullchain.pem")]),e._v(" : cert.pem + chain.pem")])]),e._v(" "),s("h2",{attrs:{id:"root-ca-포함-인증"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#root-ca-포함-인증"}},[e._v("#")]),e._v(" Root CA 포함 인증")]),e._v(" "),s("p",[e._v("Let's encrypt 인증서 fullchain에서 RootCA 인증서는 포함되지 않음 (Intermediate CA 정보만 입력된 Chain)")]),e._v(" "),s("blockquote",[s("p",[e._v("Let's encrypt 인증 구조: "),s("a",{attrs:{href:"https://letsencrypt.org/certificates/#root-certificates",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://letsencrypt.org/certificates/#root-certificates"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("따라서 Let's encrypt 인증서 대상으로 검증을 실행하면 오류가 발생함")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("openssl verify -CAfile chain.pem cert.pem\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# cert.pem: C = US, O = Let's Encrypt, CN = Let's Encrypt Authority X3")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# error 2 at 1 depth lookup:unable to get issuer certificate")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("발급받은 서버 인증서를 Root CA 포함된 fullchain 인증서로 재검증 할 수 있다")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v(" root-fullchain.pem\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" ca.cer "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" root-fullchain.pem\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("root-ca"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(".crt "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" root-fullchain.pem\n\nopenssl verify -CAfile root-fullchain.pem "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("my-cert"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(".cer\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h2",{attrs:{id:"acme-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh"}},[e._v("#")]),e._v(" acme.sh")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://acme.sh/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://acme.sh/"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("인증서 갱신에 사용되는 "),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc8555",target:"_blank",rel:"noopener noreferrer"}},[e._v("ACME 프로토콜"),s("OutboundLink")],1),e._v(" shell script 구현체이다")]),e._v(" "),s("p",[e._v("여러 CA를 지원하지만 기본값으로 Let's encrypt를 사용할 수 있다.")]),e._v(" "),s("h3",{attrs:{id:"acme-sh-설치"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh-설치"}},[e._v("#")]),e._v(" acme.sh 설치")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" https://get.acme.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" -s "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("email")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("my@example.com\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("The installer will perform 3 actions:")]),e._v(" "),s("ul",[s("li",[e._v("Create and copy acme.sh to your home dir ($HOME): ~/.acme.sh/. All certs will be placed in this folder too.")]),e._v(" "),s("li",[e._v("Create alias for: acme.sh=~/.acme.sh/acme.sh.")]),e._v(" "),s("li",[e._v("Create daily cron job to check and renew the certs if needed.")])]),e._v(" "),s("h3",{attrs:{id:"acme-sh-using-webroot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh-using-webroot"}},[e._v("#")]),e._v(" acme.sh using Webroot")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh#2-just-issue-a-cert",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/acmesh-official/acme.sh#2-just-issue-a-cert"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("도메인과 연결된 웹서버 serving 경로 내에서 쓰기 권한을 가지고 있으면, ACME 프로토콜을 통해 도메인 소유권을 확인받아 인증서를 발급받는다")]),e._v(" "),s("h3",{attrs:{id:"acme-sh-using-dns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh-using-dns"}},[e._v("#")]),e._v(" acme.sh using DNS")]),e._v(" "),s("p",[e._v("wildcard("),s("code",[e._v("*")]),e._v(") 인증서는 DNS 방식을 사용해야 함")]),e._v(" "),s("h4",{attrs:{id:"automatic-dns-api-integration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#automatic-dns-api-integration"}},[e._v("#")]),e._v(" "),s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh#8-automatic-dns-api-integration",target:"_blank",rel:"noopener noreferrer"}},[e._v("Automatic DNS API integration"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh/wiki/dnsapi",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/acmesh-official/acme.sh/wiki/dnsapi"),s("OutboundLink")],1)]),e._v(" "),s("h4",{attrs:{id:"use-dns-manual-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#use-dns-manual-mode"}},[e._v("#")]),e._v(" "),s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh#9-use-dns-manual-mode",target:"_blank",rel:"noopener noreferrer"}},[e._v("Use DNS manual mode"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh/wiki/dns-manual-mode",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/acmesh-official/acme.sh/wiki/dns-manual-mode"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("DNS API 사용가능한 경우 권장하지 않는 방법임(직접 도메인 txt record 수정해야 하고 자동갱신을 할 수 없다)")]),e._v(" "),s("h3",{attrs:{id:"acme-sh-갱신-및-중단"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acme-sh-갱신-및-중단"}},[e._v("#")]),e._v(" acme.sh 갱신 및 중단")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh#12-how-to-renew-the-certs",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/acmesh-official/acme.sh#12-how-to-renew-the-certs"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/acmesh-official/acme.sh#13-how-to-stop-cert-renewal",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/acmesh-official/acme.sh#13-how-to-stop-cert-renewal"),s("OutboundLink")],1)])]),e._v(" "),s("h2",{attrs:{id:"certbot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot"}},[e._v("#")]),e._v(" Certbot")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://certbot.eff.org/instructions",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://certbot.eff.org/instructions"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://certbot.eff.org/docs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://certbot.eff.org/docs/"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#getting-certificates-and-choosing-plugins",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://certbot.eff.org/docs/using.html#getting-certificates-and-choosing-plugins"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("python으로 작성된 Let's encrypt 인증서 발급용 스크립트")]),e._v(" "),s("blockquote",[s("p",[s("code",[e._v("/etc/letsencrypt/archive")]),e._v(" -> (symbolic link) "),s("code",[e._v("/etc/letsencrypt/live/<domain_name>")])])]),e._v(" "),s("h3",{attrs:{id:"certbot-standalone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-standalone"}},[e._v("#")]),e._v(" Certbot: Standalone")]),e._v(" "),s("p",[e._v("별도의 서버 없이 certbot 임시서버를 사용해 인증서를 생성함 ("),s("code",[e._v("80")]),e._v("번 포트를 사용할 수 있어야 한다)")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" certbot certonly --authenticator standalone "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    -d example.com -d www.example.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    --pre-hook "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"systemctl stop nginx"')]),e._v(" --post-hook "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"systemctl start nginx"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"certbot-dns"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-dns"}},[e._v("#")]),e._v(" Certbot: DNS")]),e._v(" "),s("blockquote",[s("p",[e._v("도메인에 WildCard 사용을 위해서는 TXT record를 통한 DNS 인증을 해야한다")])]),e._v(" "),s("h4",{attrs:{id:"certbot-dns-plugins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-dns-plugins"}},[e._v("#")]),e._v(" Certbot: DNS plugins")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#dns-plugins",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://certbot.eff.org/docs/using.html#dns-plugins"),s("OutboundLink")],1)]),e._v(" "),s("h4",{attrs:{id:"certbot-dns-manual"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-dns-manual"}},[e._v("#")]),e._v(" Certbot: DNS manual")]),e._v(" "),s("p",[e._v("DNS의 TXT record로 인증 후 발급")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("certbot certonly --manual --preferred-challenges dns -d pravusid.kr -d www.pravusid.kr\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Are you OK with your IP being logged?:")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -> Yes")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Please deploy a DNS TXT record under the name")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -> 출력되는 random string을 _acme-challenge.pravusid.kr TXT record에 등록함")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -> 등록후 $ nslookup -q=TXT _acme-challenge.pravusid.kr 입력하여 적용 확인")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("h3",{attrs:{id:"certbot-webroot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-webroot"}},[e._v("#")]),e._v(" Certbot: webroot")]),e._v(" "),s("h4",{attrs:{id:"certbot-webroot-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-webroot-nginx"}},[e._v("#")]),e._v(" Certbot: webroot NGINX")]),e._v(" "),s("p",[e._v("Challenge Seed를 외부에서 접근 가능한 경로에("),s("code",[e._v("/.well-known")]),e._v(")에 위치시켜 인증받는다")]),e._v(" "),s("p",[s("code",[e._v("sudo certbot certonly --cert-name <인증서이름> --webroot -w /var/www/certbot -d example.com -d www.example.com")])]),e._v(" "),s("p",[e._v("인증서 생성 도중 대상 도메인에 대한 소유권 확인 과정을 거친다")]),e._v(" "),s("p",[s("code",[e._v("http://example.com/.well-known/acme-challenge/<RANDOM_STRING>")]),e._v(" 경로로 접속할 때 값이 출력되어야 함")]),e._v(" "),s("p",[e._v("WebRoot로 사용할 디렉토리를 생성한다")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" /var/www/certbot\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("chown")]),e._v(" nginx:nginx /var/www/certbot\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("700")]),e._v(" /var/www/certbot\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[s("code",[e._v("/etc/nginx/conf.d/letsencrypt.conf")]),e._v(" 파일에서 well-known 디렉토리와 WebRoot를 연결한다")]),e._v(" "),s("div",{staticClass:"language-conf line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('location /.well-known/acme-challenge/ {\n    root /var/www/certbot/;\n}\n\n# 또는\n\nlocation ^~ /.well-known/acme-challenge/ {\n    default_type "text/plain";\n    root /home/www/certbot;\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[s("code",[e._v("/etc/nginx/servers-available/domain.conf")])]),e._v(" "),s("div",{staticClass:"language-conf line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("server {\n    server_name domain.tld\n    # ...\n    include conf.d/letsencrypt.conf;\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[s("code",[e._v("sites-available")]),e._v("에서 다음을 추가한다")]),e._v(" "),s("div",{staticClass:"language-conf line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("server {\n    server_name www.mysite.com;\n    listen 443 ssl http2 default_server;\n    listen [::]:443 ssl http2 default_server ipv6only=on;\n\n    ssl_certificate /etc/letsencrypt/live/www.mysite.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/www.mysite.com/privkey.pem;\n    ssl_trusted_certificate /etc/letsencrypt/live/www.mysite.com/chain.pem;\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h4",{attrs:{id:"certbot-webroot-apache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-webroot-apache"}},[e._v("#")]),e._v(" Certbot: webroot Apache")]),e._v(" "),s("p",[e._v("아파치 설정파일")]),e._v(" "),s("div",{staticClass:"language-conf line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('Alias /.well-known/acme-challenge/ "/var/www/certbot/.well-known/acme-challenge/"\n<Directory "/var/www/certbot/">\n    Options None\n    AllowOverride None\n    ForceType text/plain\n    RedirectMatch 404 "^(?!/\\.well-known/acme-challenge/[\\w-]{43}$)"\n</Directory>\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("p",[e._v("인증서 생성")]),e._v(" "),s("p",[s("code",[e._v("sudo certbot certonly --cert-name <인증서이름> --webroot -w /var/www/certbot -d example.com -d www.example.com")])]),e._v(" "),s("p",[e._v("리버스 프록시 사용시 다음 추가")]),e._v(" "),s("p",[s("code",[e._v("ProxyPass /.wellknown !")])]),e._v(" "),s("h3",{attrs:{id:"certbot-auto-nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-auto-nginx"}},[e._v("#")]),e._v(" Certbot: auto NGINX")]),e._v(" "),s("blockquote",[s("p",[e._v("The Nginx plugin should work for most configurations. We recommend backing up Nginx configurations before using it\n(though you can also revert changes to configurations with certbot --nginx rollback)")])]),e._v(" "),s("p",[e._v("인증서 발급: "),s("code",[e._v("sudo certbot --nginx -d example.com -d www.example.com")])]),e._v(" "),s("ul",[s("li",[s("code",[e._v("/etc/nginx/sites-available/default")])]),e._v(" "),s("li",[s("code",[e._v("/etc/nginx/sites-available/example.com")])])]),e._v(" "),s("p",[e._v("두 파일 중 하나를 선택해("),s("code",[e._v("example.com")]),e._v(" 이름도 변경) "),s("code",[e._v("server_name")]),e._v("을 도메인 이름으로 변경")]),e._v(" "),s("div",{staticClass:"language-conf line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# http 요청을 https로 리다이렉트\nserver {\n    server_name www.example.com example.com;\n\n    return 301 https://example.com$request_uri;\n}\n\n# www 서브도메인을 리다이렉트\nserver {\n    listen 443 ssl http2;\n\n    server_name www.example.com;\n    include snippets/ssl-params.conf;\n\n    return 301 https://example.com$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n\n    server_name example.com;\n    include snippets/ssl-params.conf;\n\n    root /var/www/example.com;\n    index index.html;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br")])]),s("p",[e._v("만약 다른 포트(:8080)가 리다이렉트로 인해 인증서 오류가 나면, 포트는 리다이렉트 제외 설정할 수 있음")]),e._v(" "),s("div",{staticClass:"language-conf line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("server {\n    port_in_redirect off;\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("p",[e._v("적용 (defalut 파일은 기본적으로 sites-enabled에 심볼릭 링크가 있음)")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ln")]),e._v(" -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" nginx -t\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" nginx restart\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"certbot-도메인-변경"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-도메인-변경"}},[e._v("#")]),e._v(" Certbot: 도메인 변경")]),e._v(" "),s("p",[s("code",[e._v("certbot certonly --cert-name <인증서 이름> -d <도메인1>,<도메인2>")])]),e._v(" "),s("h3",{attrs:{id:"certbot-인증서-갱신"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-인증서-갱신"}},[e._v("#")]),e._v(" Certbot: 인증서 갱신")]),e._v(" "),s("ul",[s("li",[e._v("갱신 가능여부 확인: "),s("code",[e._v("sudo certbot renew --dry-run")])]),e._v(" "),s("li",[e._v("certbot-auto의 경우: "),s("code",[e._v("--no-self-upgrade")]),e._v("를 추가하여 certbot의 업그레이드를 막음")]),e._v(" "),s("li",[e._v("Ubuntu의 경우 "),s("code",[e._v("/etc/cron.d/")]),e._v("에 certbot이 생성되어있음: "),s("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#automated-renewals",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://certbot.eff.org/docs/using.html#automated-renewals"),s("OutboundLink")],1)])]),e._v(" "),s("blockquote",[s("p",[e._v("Many Linux distributions provide automated renewal when you use the packages installed through their system package manager.")])]),e._v(" "),s("p",[e._v("cron job을 등록한다")]),e._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("crontab")]),e._v(" -e\n"),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("19")]),e._v(" * * * certbot renew --quiet --post-hook "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"service nginx reload"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("등록된 job을 확인한다: "),s("code",[e._v("crontab -l")])]),e._v(" "),s("h3",{attrs:{id:"certbot-인증서-제거"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#certbot-인증서-제거"}},[e._v("#")]),e._v(" Certbot: 인증서 제거")]),e._v(" "),s("ul",[s("li",[e._v("인증제거: "),s("code",[e._v("sudo certbot delete --cert-name <인증서이름>")])]),e._v(" "),s("li",[e._v("인증제거(대화형): "),s("code",[e._v("sudo certbot delete")])]),e._v(" "),s("li",[e._v("인증서 revoke: "),s("a",{attrs:{href:"https://certbot.eff.org/docs/using.html#revoking-certificates",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://certbot.eff.org/docs/using.html#revoking-certificates"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);