(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{389:function(s,e,n){"use strict";n.r(e);var a=n(0),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" NGINX")]),s._v(" "),n("p",[s._v("Web Server (Apache와 2강 구도를 형성하고 있다)")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Apache : 요청을 Multi Processing Module 방식으로 처리")]),s._v(" "),n("ul",[n("li",[s._v("Prefork: 실행중인 프로세스를 복제하여 처리")]),s._v(" "),n("li",[s._v("Worker: 여러 프로세스가 여러 쓰레드를 사용한다")])])]),s._v(" "),n("li",[n("p",[s._v("Nginx : Event Driven 방식으로 요청을 비동기 처리함")])])]),s._v(" "),n("h2",{attrs:{id:"설치-및-실행"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#설치-및-실행"}},[s._v("#")]),s._v(" 설치 및 실행")]),s._v(" "),n("ul",[n("li",[s._v("설치: "),n("code",[s._v("sudo apt install nginx")])]),s._v(" "),n("li",[s._v("실행: "),n("code",[s._v("sudo service nginx start")])])]),s._v(" "),n("h2",{attrs:{id:"명령"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#명령"}},[s._v("#")]),s._v(" 명령")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("nginx -s stop")]),s._v(": 바로 종료 (TERM)")]),s._v(" "),n("li",[n("code",[s._v("nginx -s quit")]),s._v(": 정상 종료 (QUIT)")]),s._v(" "),n("li",[n("code",[s._v("nginx -s reload")]),s._v(": 환경설정을 다시 읽음")]),s._v(" "),n("li",[n("code",[s._v("nginx -s reopen")]),s._v(": 로그 파일을 다시 연다")])]),s._v(" "),n("h2",{attrs:{id:"설정"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#설정"}},[s._v("#")]),s._v(" 설정")]),s._v(" "),n("p",[s._v("설정파일 위치: "),n("code",[s._v("/etc/nginx/nginx.conf")])]),s._v(" "),n("p",[s._v("환경설정 구문 체크: "),n("code",[s._v("nginx -t")])]),s._v(" "),n("p",[s._v("설정 생성후 심볼릭 링크, 적용")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /etc/nginx/sites-enabled/default\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /etc/nginx/sites-available/"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("conf_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".conf /etc/nginx/sites-enabled/"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("conf_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(".conf\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx -t\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"설정-파일-예시"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#설정-파일-예시"}},[s._v("#")]),s._v(" 설정 파일 예시")]),s._v(" "),n("p",[n("code",[s._v("site-available/<conf_name>.conf")])]),s._v(" "),n("p",[s._v("동일 sub-domain에서 443(https default), 8080 포트를 각각 listen")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# Default server configuration\n\nserver {\n    root /var/www/html;\n\n    # Add index.php to the list if you are using PHP\n    index index.html index.htm index.nginx-debian.html;\n\n    server_name aws.pravusid.kr;\n\n    location / {\n        # First attempt to serve request as file, then\n        # as directory, then fall back to displaying a 404.\n        # try_files $uri $uri/ =404;\n        try_files $uri $uri/ /index.html;\n    }\n\n    port_in_redirect off;\n\n    listen [::]:443 ssl ipv6only=on; # managed by Certbot\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/aws.pravusid.kr/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/aws.pravusid.kr/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\n\nserver {\n    server_name aws.pravusid.kr;\n\n    port_in_redirect off;\n\n    location / {\n        proxy_set_header X-Forwarded-Host $host:$server_port;\n        proxy_set_header X-Forwarded-Server $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_pass http://localhost:8000;\n        proxy_redirect http://localhost:8000 https://$host:$server_port;\n    }\n\n    listen [::]:8080 ssl ipv6only=on; # managed by Certbot\n    listen 8080 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/aws.pravusid.kr/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/aws.pravusid.kr/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\n\nserver {\n    if ($host = aws.pravusid.kr) {\n        return 301 https://$host$request_uri;\n    }\n\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    server_name aws.pravusid.kr;\n    return 404;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br")])]),n("h3",{attrs:{id:"http-모듈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-모듈"}},[s._v("#")]),s._v(" HTTP 모듈")]),s._v(" "),n("p",[s._v("HTTP 모듈 설정은 세 가지 계층 블럭을 제공한다")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("http (프로토콜 수준)")]),s._v(" "),n("ul",[n("li",[s._v("HTTP와 관련된 모든 모듈의 지시어를 정의함")])])]),s._v(" "),n("li",[n("p",[s._v("server (서버 수준)")]),s._v(" "),n("ul",[n("li",[s._v("하나의 웹사이트를 선언하는 데 사용")]),s._v(" "),n("li",[s._v("http 블럭 안에서만 사용 가능")])])]),s._v(" "),n("li",[n("p",[s._v("location (요청 URI 수준)")]),s._v(" "),n("ul",[n("li",[s._v("웹사이트의 특정 위치에 적용할 설정 그룹 정의")]),s._v(" "),n("li",[s._v("server 블럭이나 다른 location 블럭 안에 삽입할 수 있다")])])])]),s._v(" "),n("blockquote",[n("p",[s._v("설정에 사용할 수 있는 변수 참고: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_core_module.html#var_arg_",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://nginx.org/en/docs/http/ngx_http_core_module.html#var_arg_"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"url-matching"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#url-matching"}},[s._v("#")]),s._v(" URL matching")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("server {\n    listen 80;\n    server_name *.example.com;\n\n    location optional_modifier location_match {\n        # ...\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"location-modifier"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location-modifier"}},[s._v("#")]),s._v(" location modifier")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("none")]),s._v(": prefix match")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("/site")]),s._v(" 경로에 대해 "),n("code",[s._v("/site/page1/index.html")]),s._v(" 혹은 "),n("code",[s._v("/site/index.html")]),s._v(" 등이 대응될 수 있다")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("=")]),s._v(": 정확히 일치하는 경로")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("~")]),s._v(": 대소문자를 구분하는 regular expression match")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("~*")]),s._v(": 대소문자를 구분하지 않는 regular expression match")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("^~")]),s._v(": prefix match에서 가장 일치하는 결과인 경우 regular expression match를 하지 않고 연결함")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("^~ /costumes")]),s._v("인 경우 "),n("code",[s._v("/costumes/ninja.html")]),s._v(" 경로는 정규식 매칭을 하지 않고 바로 연결함")])])])]),s._v(" "),n("h2",{attrs:{id:"리버스-프록시"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#리버스-프록시"}},[s._v("#")]),s._v(" 리버스 프록시")]),s._v(" "),n("p",[n("code",[s._v("/etc/nginx/sites-available/default")])]),s._v(" "),n("h3",{attrs:{id:"요청-흐름제어"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#요청-흐름제어"}},[s._v("#")]),s._v(" 요청 흐름제어")]),s._v(" "),n("p",[s._v("server 아래의 location을 다음과 같이 수정")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("proxy_pass")])]),s._v(" "),n("ul",[n("li",[s._v("요청이 오면 해당 위치로 전달")]),s._v(" "),n("li",[n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass"),n("OutboundLink")],1)])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("proxy_set_header <헤더> <헤더값>")])]),s._v(" "),n("ul",[n("li",[s._v("요청의 헤더에 정의한 값 할당")]),s._v(" "),n("li",[n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header"),n("OutboundLink")],1)])])]),s._v(" "),n("li",[n("p",[s._v("SSL을 사용하는 경우")]),s._v(" "),n("ul",[n("li",[s._v("헤더설정: "),n("a",{attrs:{href:"https://www.nginx.com/resources/wiki/start/topics/examples/likeapache/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.nginx.com/resources/wiki/start/topics/examples/likeapache/"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("프록시 리다이렉트: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_redirect"),n("OutboundLink")],1)])])])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location / {\n    proxy_set_header X-Forwarded-Host $host:$server_port;\n    proxy_set_header X-Forwarded-Server $host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_pass http://localhost:8000;\n    proxy_redirect http://localhost:8000 https://$host:$server_port;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("해당 위치를 변수로 설정하고 싶으면")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("include /etc/nginx/conf.d/service-url.inc;\n\nlocation / {\n    proxy_pass $service_url;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("code",[s._v("/etc/nginx/conf.d/service-url.inc")]),s._v(" 파일 내용은 다음으로 한다")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("set $service_url http://localhost:8000;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"로드밸런싱"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#로드밸런싱"}},[s._v("#")]),s._v(" 로드밸런싱")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("upstream test_proxy {\n    <LOAD_BALANCING_METHOD>\n    server web-01;\n    server web-02;\n}\nserver {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n\n    root /var/www/html;\n\n    index index.html index.htm index.nginx-debian.html;\n\n    server_name _;\n\n    location / {\n        proxy_pass http://test_proxy;\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("로드밸런싱 메소드("),n("code",[s._v("<LOAD_BALANCING_METHOD>")]),s._v(" 위치)")]),s._v(" "),n("ul",[n("li",[s._v("default: round-robin")]),s._v(" "),n("li",[s._v("least_conn: 연결이 적은곳으로")]),s._v(" "),n("li",[s._v("ip_hash: 클라이언트 IP주소를 기준으로 요청 분배")]),s._v(" "),n("li",[s._v("hash: 유저정의 변수 조합을 해싱하여 기준으로 사용")]),s._v(" "),n("li",[s._v("least_time: 평균 레이턴시와 연결을 기준으로")])]),s._v(" "),n("h3",{attrs:{id:"정규표현식-매칭"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#정규표현식-매칭"}},[s._v("#")]),s._v(" 정규표현식 매칭")]),s._v(" "),n("p",[s._v("URI를 정규표현식 매칭으로 분류했으면, 리버스 프록시에서도 capturing 그룹을 넘겨줄 수 있다.")]),s._v(" "),n("p",[n("code",[s._v("location ~ ^/api/(admin|setting)/(.*)")])]),s._v(" "),n("p",[s._v("위와 같은 정규표현식 매칭이 있다면 리버스프록시 호출에서 캡쳐 그룹을 "),n("code",[s._v("$순서")]),s._v("로 사용할 수 있다.\n또한, "),n("code",[s._v("$is_args")]),s._v(", "),n("code",[s._v("$args")]),s._v("로 query-string을 받을 수 있다.")]),s._v(" "),n("p",[n("code",[s._v("proxy_pass http://localhost:8080/$1/$2$is_args$args;")])]),s._v(" "),n("p",[s._v("위와 같은 방법 대신 "),n("code",[s._v("rewrite")]),s._v("를 사용할 수도 있다. 이 경우 query-string은 nginx가 처리한다.")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location /api/ {\n    rewrite ^/api/(admin|setting)/(.*) /$1/$2 break;\n    proxy_pass http://localhost:8080;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"ip-제한"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ip-제한"}},[s._v("#")]),s._v(" IP 제한")]),s._v(" "),n("p",[s._v("위 -> 아래 순서대로 작동함")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("location ^~ /admin/ {\n    deny 1.1.1.1; # Deny a single IP\n    deny 2.2.2.0/24; #Deny a IP range\n    allow 3.3.3.3;\n    allow 1.1.1.0/24;\n    deny all; # Deny everyone else\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"load-balancer-elb-등으로-인해-nginx에-ip가-전달되지-않는-경우"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#load-balancer-elb-등으로-인해-nginx에-ip가-전달되지-않는-경우"}},[s._v("#")]),s._v(" Load Balancer (ELB...)등으로 인해 nginx에 ip가 전달되지 않는 경우")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("http {\n    # ...\n    real_ip_header X-Forwarded-For;\n    set_real_ip_from 10.0.0.0/8; # <- subnet IPs or Elastic Load Balance IP\n    # ...\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);