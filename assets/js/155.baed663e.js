(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{355:function(s,a,t){"use strict";t.r(a);var n=t(17),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mono-repository"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mono-repository"}},[s._v("#")]),s._v(" Mono Repository")]),s._v(" "),t("p",[s._v("Mono Repository(이하 monorepo)는 관련성이 큰 패키지들을 단일 저장소에서 함께 관리하는 방식이다.")]),s._v(" "),t("h2",{attrs:{id:"monorepo-in-nodejs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#monorepo-in-nodejs"}},[s._v("#")]),s._v(" monorepo in NodeJS")]),s._v(" "),t("p",[s._v("monorepo 적용방식은 여러가지가 있지만 어느새 nodejs에서는 lerna가 표준이 되어가고 있다.")]),s._v(" "),t("p",[s._v("yarn에서도 workspace 기능을 지원하는데 monorepo와 관련이 있지만 monorepo 기능을 모두 지원하는 것은 아니다.")]),s._v(" "),t("blockquote",[t("p",[s._v("npm도 v7 이후 workspace를 지원할 예정이다")])]),s._v(" "),t("p",[s._v("둘은 고유 기능과 중복 기능이 있는데 중복기능은 상황에 맞는 패키지를 사용하면 된다.")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("lerna")]),s._v(" "),t("ul",[t("li",[s._v("버전관리 (version)")]),s._v(" "),t("li",[s._v("배포관리 (publish)")]),s._v(" "),t("li",[s._v("스크립트 실행 (run)")]),s._v(" "),t("li",[s._v("의존성관리 (bootstrap / hoist, symlink)")])])]),s._v(" "),t("li",[t("p",[s._v("yarn workspace")]),s._v(" "),t("ul",[t("li",[s._v("스크립트 실행 (run)")]),s._v(" "),t("li",[s._v("의존성관리 (add / hoist, symlink)")])])])]),s._v(" "),t("p",[s._v("monorepo 내의 node_modules 중복이 많아질 수록 yarn workspace의 성능이 좋다\n(참고: "),t("a",{attrs:{href:"https://doppelmutzi.github.io/monorepo-lerna-yarn-workspaces/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://doppelmutzi.github.io/monorepo-lerna-yarn-workspaces/"),t("OutboundLink")],1),s._v(")")]),s._v(" "),t("h2",{attrs:{id:"lerna"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lerna"}},[s._v("#")]),s._v(" Lerna")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/lerna/lerna"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("주요 명령어는 다음과 같다")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna/tree/main/commands/init#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("init"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("Create a new Lerna repo or upgrade an existing repo to the current version of Lerna")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna/tree/main/commands/bootstrap#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("bootstrap"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("Bootstrap the packages in the current Lerna repo. Installs all of their dependencies and links any cross-dependencies.")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna/tree/main/commands/version#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("version"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("Bump version of packages changed since the last release")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna/tree/main/commands/publish#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("publish"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("Publish packages in the current project")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/lerna/lerna/tree/main/commands/run#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("run"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("Run an npm script in each package that contains that script")])]),s._v(" "),t("h2",{attrs:{id:"yarn-workspace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yarn-workspace"}},[s._v("#")]),s._v(" Yarn workspace")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/workspaces/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://classic.yarnpkg.com/en/docs/workspaces/"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/cli/workspace",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://classic.yarnpkg.com/en/docs/cli/workspace"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://classic.yarnpkg.com/en/docs/cli/workspaces",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://classic.yarnpkg.com/en/docs/cli/workspaces"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"monorepo-적용-w-github-package-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#monorepo-적용-w-github-package-registry"}},[s._v("#")]),s._v(" monorepo 적용 (w/ github package registry)")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://viewsource.io/publishing-and-installing-private-github-packages-using-yarn-and-lerna/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://viewsource.io/publishing-and-installing-private-github-packages-using-yarn-and-lerna/"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" init\nlerna init --independent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("프로젝트 루트에 "),t("code",[s._v("package.json")]),s._v(" 파일과 "),t("code",[s._v("lerna.json")]),s._v(" 설정파일이 생성된다")]),s._v(" "),t("h3",{attrs:{id:"package-json"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[s._v("#")]),s._v(" "),t("code",[s._v("package.json")])]),s._v(" "),t("h4",{attrs:{id:"root"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#root"}},[s._v("#")]),s._v(" root")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monorepo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"workspaces"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages/core"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages/*"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("workspace 목록을 별도 표기하여 빌드 실행 우선순위를 지정할 수 있음")]),s._v(" "),t("h4",{attrs:{id:"in-packages"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#in-packages"}},[s._v("#")]),s._v(" in packages")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.npmjs.com/cli/v6/configuring-npm/package-json#repository",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.npmjs.com/cli/v6/configuring-npm/package-json#repository"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("패키지 이름은 "),t("code",[s._v("@scope")]),s._v(" + 워크스페이스 prefix 경로("),t("code",[s._v("packages/*")]),s._v(")를 제외한 패키지로 정의하고")]),s._v(" "),t("p",[s._v("각 패키지의 "),t("code",[s._v("package.json")]),s._v(" 파일에 다음 내용을 추가한다")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ...\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@scope/package-name-without-workspaces-prefix"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"repository"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"git"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"url"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ssh://git@github.com/idpravus/monorepo.git"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"directory"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"packages/package-name-without-workspaces-prefix"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"publishConfig"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://npm.pkg.github.com/"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  ...\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h3",{attrs:{id:"lerna-json"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lerna-json"}},[s._v("#")]),s._v(" "),t("code",[s._v("lerna.json")])]),s._v(" "),t("p",[s._v("다음 내용을 추가한다")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  ...\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"npmClient"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yarn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"useWorkspaces"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"command"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"message"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"release"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ignoreChanges"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"**/*.spec.ts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"**/*.md"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"publish"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://npm.pkg.github.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allowBranch"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"typescript"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#typescript"}},[s._v("#")]),s._v(" TypeScript")]),s._v(" "),t("p",[s._v("타입스크립트 컴파일러 설정과 type export 경로 처리에 주의해야 한다")]),s._v(" "),t("h3",{attrs:{id:"사용"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#사용"}},[s._v("#")]),s._v(" 사용")]),s._v(" "),t("p",[s._v("다른 모듈을 사용하기 위해서는 "),t("code",[s._v("Peer Dependencies")]),s._v(" 또는 "),t("code",[s._v("Dependencies")]),s._v(" 선언한 뒤 "),t("code",[s._v("import")]),s._v(" 해서 사용한다")])])}),[],!1,null,null,null);a.default=r.exports}}]);