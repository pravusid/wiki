(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{534:function(s,e,a){"use strict";a.r(e);var t=a(28),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh"}},[s._v("#")]),s._v(" SSH")]),s._v(" "),a("p",[s._v("시큐어 셸(Secure Shell, SSH)은 네트워크 상의 다른 컴퓨터에 로그인하거나 원격 시스템에서 명령을 실행하고 다른 시스템으로 파일을 복사할 수 있도록 해 주는 응용 프로그램 또는 그 프로토콜을 가리킨다.")]),s._v(" "),a("p",[s._v("기존의 rsh, rlogin, 텔넷 등을 대체하기 위해 설계되었으며, 강력한 인증 방법 및 안전하지 못한 네트워크에서 안전하게 통신을 할 수 있는 기능을 제공한다.")]),s._v(" "),a("p",[s._v("기본적으로는 22번 포트를 사용한다.")]),s._v(" "),a("h2",{attrs:{id:"설치"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#설치"}},[s._v("#")]),s._v(" 설치")]),s._v(" "),a("p",[a("code",[s._v("sudo apt install openssh-server")])]),s._v(" "),a("h2",{attrs:{id:"기본명령어"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#기본명령어"}},[s._v("#")]),s._v(" 기본명령어")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-b bind_address")]),s._v(": ip가 두개이상인 경우")]),s._v(" "),a("li",[a("code",[s._v("-E log_file")])]),s._v(" "),a("li",[a("code",[s._v("-e escape_char")])]),s._v(" "),a("li",[a("code",[s._v("-F configfile")])]),s._v(" "),a("li",[a("code",[s._v("-i identity_file")])]),s._v(" "),a("li",[a("code",[s._v("-J [user@]host[:port]")]),s._v(" (ProxyJump)")]),s._v(" "),a("li",[a("code",[s._v("-p port")])])]),s._v(" "),a("p",[a("code",[s._v("ssh [user@]hostname [command]")])]),s._v(" "),a("h2",{attrs:{id:"인증"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#인증"}},[s._v("#")]),s._v(" 인증")]),s._v(" "),a("h3",{attrs:{id:"ssh-비대칭-키-발급"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-비대칭-키-발급"}},[s._v("#")]),s._v(" SSH 비대칭 키 발급")]),s._v(" "),a("p",[s._v("RSA(ed25519) 방식의 비대칭키를 생성함")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ssh-keygen -t rsa -C "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"comment"')]),s._v("\nssh-keygen -t ed25519 -C "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"comment"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Convert "),a("code",[s._v("BEGIN OPENSSH PRIVATE KEY")]),s._v(" to "),a("code",[s._v("BEGIN RSA PRIVATE KEY")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" id_rsa id_rsa.pem\nssh-keygen -p -m PEM -f id_rsa.pem\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"비대칭-키를-사용해-인증-비밀번호-입력-대신"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#비대칭-키를-사용해-인증-비밀번호-입력-대신"}},[s._v("#")]),s._v(" 비대칭 키를 사용해 인증 (비밀번호 입력 대신)")]),s._v(" "),a("p",[s._v("공개키를 서버의 "),a("code",[s._v("authorized_keys")]),s._v("에 등록: "),a("code",[s._v("ssh-copy-id user@host")])]),s._v(" "),a("p",[s._v("서버에서 권한 설정")]),s._v(" "),a("blockquote",[a("p",[s._v("permissions are too open 오류")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" ~/.ssh/id_rsa\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/id_rsa.pub\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v(" ~/.ssh/known_hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"ssh-연결을-비대칭-키만-사용-비밀번호-사용x"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-연결을-비대칭-키만-사용-비밀번호-사용x"}},[s._v("#")]),s._v(" ssh 연결을 비대칭 키만 사용(비밀번호 사용X)")]),s._v(" "),a("p",[a("code",[s._v("/etc/ssh/sshd_config")]),s._v(" 설정파일 수정")]),s._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[s._v("PubkeyAuthentication yes\nPasswordAuthentication no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"공개키-복사"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#공개키-복사"}},[s._v("#")]),s._v(" 공개키 복사")]),s._v(" "),a("p",[s._v("원격서버에서 패스워드 인증을 사용하는 경우")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("-i")]),s._v(" 옵션을 사용하지 않으면 기본값은 "),a("code",[s._v("id_rsa.pub")]),s._v("임")])]),s._v(" "),a("p",[a("code",[s._v("ssh-copy-id [-i pubkey_file] <user>@<host>")])]),s._v(" "),a("p",[s._v("원격서버에서 공개키 인증을 사용하는 경우")]),s._v(" "),a("p",[a("code",[s._v("ssh <user>@<host> 'cat >> ~/.ssh/authorized_keys' < ~/.ssh/id_rsa.pub")])]),s._v(" "),a("h2",{attrs:{id:"ssh-config-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-config-설정"}},[s._v("#")]),s._v(" SSH config 설정")]),s._v(" "),a("p",[a("code",[s._v(".ssh/config")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Host *\n    ServerAliveInterval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n\nHost "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host-alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host-alias"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    HostName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("remote-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    User "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    IdentityFile ~/.ssh/my-identity.pem\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("Identity 파일을 지정하지 않으면 "),a("code",[s._v(".ssh/id_rsa")]),s._v("가 기본으로 사용된다")]),s._v(" "),a("h3",{attrs:{id:"host-key-checking-비활성화"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#host-key-checking-비활성화"}},[s._v("#")]),s._v(" Host Key Checking 비활성화")]),s._v(" "),a("p",[a("code",[s._v("~/.ssh/known_hosts")]),s._v(" 등록시 키검증 생략 (MITM 위험성)")]),s._v(" "),a("p",[a("code",[s._v(".ssh/config")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Host *\n    StrictHostKeyChecking no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"root-로그인-차단"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#root-로그인-차단"}},[s._v("#")]),s._v(" root 로그인 차단")]),s._v(" "),a("div",{staticClass:"language-txt line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-txt"}},[a("code",[s._v("PermitRootLogin no\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"secure-copy-scp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secure-copy-scp"}},[s._v("#")]),s._v(" Secure Copy (SCP)")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("옵션"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("원본 경로 및 파일명"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("대상 경로 및 파일명"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("옵션")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-P")]),s._v(" : 포트번호")]),s._v(" "),a("li",[a("code",[s._v("-p")]),s._v(" : 원본 파일 시간의 수정시간, 사용시간, 권한을 유지한다 (preserve)")]),s._v(" "),a("li",[a("code",[s._v("-r")]),s._v(" : 하위 폴더/파일 모두 복사한다 (recursive)")])])]),s._v(" "),a("li",[a("p",[s._v("사용 예")]),s._v(" "),a("ul",[a("li",[s._v("보내기 : "),a("code",[s._v("scp -rp 파일명 user@host:~/다운로드/파일명")])]),s._v(" "),a("li",[s._v("받기 : "),a("code",[s._v("scp -rp user@host:~/다운로드/파일명 로컬경로/파일명")])])])])]),s._v(" "),a("h2",{attrs:{id:"ssh-port-forwarding-tunneling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-port-forwarding-tunneling"}},[s._v("#")]),s._v(" SSH Port Forwarding (Tunneling)")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Tunnels",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Tunnels"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("C")]),s._v(" (압축하여 접속)")]),s._v(" "),a("li",[a("code",[s._v("N")]),s._v(" (shell 명령어 실행 금지)")]),s._v(" "),a("li",[a("code",[s._v("f")]),s._v(" (백그라운드로 실행)")])]),s._v(" "),a("h3",{attrs:{id:"local-forwarding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#local-forwarding"}},[s._v("#")]),s._v(" Local Forwarding")]),s._v(" "),a("p",[a("code",[s._v("ssh -L <PORT1>:remote:<PORT2> [user@]server")])]),s._v(" "),a("p",[s._v("다음의 연결이 성립한다: "),a("code",[s._v("localhost:<PORT1> -> server == tunnel -> remote:<PORT2>")])]),s._v(" "),a("p",[s._v("remote는 server에서 도달할 수 있는 "),a("code",[s._v("<hostname | ip address>")]),s._v("를 사용하여야 한다")]),s._v(" "),a("p",[a("code",[s._v("ssh -i ~/.ssh/id_rsa -N -L 8080:localhost:3000 -L 8081:192.168.0.100:3001 me@pravusid.kr")])]),s._v(" "),a("p",[a("code",[s._v(".ssh/config")]),s._v(" 설정으로도 실행가능하다")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Host pravusid\n    HostName pravusid.kr\n    User me\n    LocalForward 8080 localhost:3000\n    LocalForward 8081 192.168.0.100:3001\n    ExitOnForwardFailure yes\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"remote-forwarding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remote-forwarding"}},[s._v("#")]),s._v(" Remote Forwarding")]),s._v(" "),a("p",[a("code",[s._v("ssh -R [허용IP:]8080:localhost:80 public.example.com")])]),s._v(" "),a("p",[s._v("다음의 연결이 성립한다: "),a("code",[s._v("public.example.com:8080 -> localhost:80")])]),s._v(" "),a("p",[s._v("사용을 위해서 ssh 설정을 변경해야 한다")]),s._v(" "),a("p",[a("code",[s._v("/etc/ssh/sshd_config")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("GatewayPorts "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"ssh-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-proxy"}},[s._v("#")]),s._v(" SSH Proxy")]),s._v(" "),a("h3",{attrs:{id:"ssh-agent-forwarding-vs-ssh-proxyjump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-agent-forwarding-vs-ssh-proxyjump"}},[s._v("#")]),s._v(" SSH Agent Forwarding vs SSH ProxyJump")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://rabexc.org/posts/pitfalls-of-ssh-agents",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://rabexc.org/posts/pitfalls-of-ssh-agents"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.infoworld.com/article/3619278/proxyjump-is-safer-than-ssh-agent-forwarding.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.infoworld.com/article/3619278/proxyjump-is-safer-than-ssh-agent-forwarding.html"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("ProxyJump를 사용해야 하는 이유")]),s._v(" "),a("ul",[a("li",[s._v("agent forwarding의 경우 인증체인에서 루트권한이 있다면, agent가 바인딩된 unix-domain 소켓을 사용하여 ssh-agent를 탈취할 수 있음")]),s._v(" "),a("li",[s._v("forward agent를 사용하지 않는 프록시 점프 사용을 권장함 (OpenSSH 7.3 이상의 버전)")]),s._v(" "),a("li",[s._v("ProxyJump는 로컬 클라이언트의 표준 입출력을 목적지 호스트로 포워딩한다")])]),s._v(" "),a("h3",{attrs:{id:"proxycommand-vs-proxyjump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxycommand-vs-proxyjump"}},[s._v("#")]),s._v(" ProxyCommand vs ProxyJump")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Proxies_and_Jump_Hosts",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Proxies_and_Jump_Hosts"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://goteleport.com/blog/ssh-proxyjump-ssh-proxycommand/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://goteleport.com/blog/ssh-proxyjump-ssh-proxycommand/"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("ProxyJump 명령어는 OpenSSH 7.3버전 이상에서 지원하므로 버전 미만에서는 ProxyCommand를 사용해야 한다")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Proxies_and_Jump_Hosts#Old_Methods_of_Passing_Through_Jump_Hosts",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Proxies_and_Jump_Hosts#Old_Methods_of_Passing_Through_Jump_Hosts"),a("OutboundLink")],1)]),s._v(" "),a("h4",{attrs:{id:"단일-host-점프"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#단일-host-점프"}},[s._v("#")]),s._v(" 단일 Host 점프")]),s._v(" "),a("p",[s._v("프록시점프는 다음 명령어로 실행할 수 있다")]),s._v(" "),a("p",[a("code",[s._v("ssh -J <juser@jump_server:port> dev@192.168.200.200")])]),s._v(" "),a("blockquote",[a("p",[s._v("점프서버 포트 22는 생략가능")])]),s._v(" "),a("p",[a("code",[s._v(".ssh/config")]),s._v(" 설정은 다음과 같다")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Host remote_server\n    HostName 192.168.200.200\n    User dev\n    ProxyJump <juser@jump_server:port>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"여러-host-점프"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#여러-host-점프"}},[s._v("#")]),s._v(" 여러 Host 점프")]),s._v(" "),a("p",[s._v("여러 호스트를 대상으로 점프할 수도 있다")]),s._v(" "),a("p",[a("code",[s._v("ssh -J <juser1@jump_server1:port>,<juser2@jump_server2:port>,<juser3@jump_server3:port> dev@192.168.200.200")])]),s._v(" "),a("p",[a("code",[s._v(".ssh/config")]),s._v(" 설정은 다음과 같다")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Host remote_server_multi\n    HostName 192.168.200.200\n    User dev\n    ProxyJump <juser1@jump_server1:port>,<juser2@jump_server2:port>,<juser3@jump_server3:port>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"특정-조건에서만-proxyjump를-실행"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#특정-조건에서만-proxyjump를-실행"}},[s._v("#")]),s._v(" 특정 조건에서만 ProxyJump를 실행")]),s._v(" "),a("p",[s._v("설정에서 Match를 사용하면 된다")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Proxies_and_Jump_Hosts#Conditional_Use_of_Jump_Hosts",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Proxies_and_Jump_Hosts#Conditional_Use_of_Jump_Hosts"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 현재 IP주소가 192.168.100.10 인 경우 프록시점프를 실행함\nMatch host server1 !exec "ifconfig en0 | grep 192.168.100.10"\n    ProxyJump user@<jump server>\n\nHost server1\n    Hostname 192.168.100.20\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("설정을 수정한 경우 별도의 인자 없이 Proxy를 실행할 수 있다: "),a("code",[s._v("ssh remoteserver")])]),s._v(" "),a("h3",{attrs:{id:"bastion-host-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bastion-host-설정"}},[s._v("#")]),s._v(" Bastion Host 설정")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://goteleport.com/blog/ssh-bastion-host/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://goteleport.com/blog/ssh-bastion-host/"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://goteleport.com/blog/security-hardening-ssh-bastion-best-practices/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://goteleport.com/blog/security-hardening-ssh-bastion-best-practices/"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("Bation Host는 외부에서 유일하게 연결할 수 있는 SSH 호스트로, 내부의 다른 호스트에 접근하는 기착지가 된다")]),s._v(" "),a("h4",{attrs:{id:"bastion-host-연결을-위한-클라이언트-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bastion-host-연결을-위한-클라이언트-설정"}},[s._v("#")]),s._v(" Bastion Host 연결을 위한 클라이언트 설정")]),s._v(" "),a("p",[a("code",[s._v(".ssh/config")])]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Match User bastionuser\n   PermitTTY no\n   X11Forwarding no\n   PermitTunnel no\n   GatewayPorts no\n   ForceCommand /usr/sbin/nologin\n\nHost *-myhost\n    ProxyJump bastionuser@bastion.example.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h4",{attrs:{id:"bastion-server-설정"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bastion-server-설정"}},[s._v("#")]),s._v(" Bastion Server 설정")]),s._v(" "),a("p",[a("code",[s._v("/etc/ssh/sshd_config")])]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Prohibit regular SSH clients from allocating virtual terminals, forward X11, etc\nPermitTTY no\nX11Forwarding no\nPermitTunnel no\nGatewayPorts no\n\n# Prohibit launching any remote commands\nForceCommand /usr/sbin/nologin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("사용자 설정")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://aws.amazon.com/ko/premiumsupport/knowledge-center/new-user-accounts-linux-instance/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://aws.amazon.com/ko/premiumsupport/knowledge-center/new-user-accounts-linux-instance/"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 사용자 생성")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -m bastionuser "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" -d bastionuser\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 사용자 생성 (ubuntu)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -m bastionuser --disabled-password\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 실행 컨텍스트 변경")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - bastionuser\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /home/bastionuser\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" .ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" .ssh\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" .ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" .ssh/authorized_keys\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" .ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 퍼블릭키 입력이 끝나면 ctrl + d")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 사용자 shell 변경")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("usermod")]),s._v(" -s /sbin/nologin bastionuser\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);