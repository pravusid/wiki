(window.webpackJsonp=window.webpackJsonp||[]).push([[192],{562:function(t,s,e){"use strict";e.r(s);var a=e(28),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"node-js-mysql-drivers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-js-mysql-drivers"}},[t._v("#")]),t._v(" Node.js MySQL Drivers")]),t._v(" "),e("p",[t._v("두 가지 선택가능한 패키지가 있다")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/mysqljs/mysql",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/mysqljs/mysql"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"timezone"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#timezone"}},[t._v("#")]),t._v(" timezone")]),t._v(" "),e("blockquote",[e("p",[t._v("[[mysql#TIMEZONE]] 참고")])]),t._v(" "),e("p",[e("code",[t._v("mysqljs")]),t._v(", "),e("code",[t._v("node-mysql2")]),t._v(" 모두 기본 설정값은 "),e("code",[t._v("'local'")])]),t._v(" "),e("p",[t._v("그러나 timezone은 database session timezone을 설정하는 것이 아니라 JavaScript Date 객체의 처리 방식을 설정하는 것이다.")]),t._v(" "),e("p",[t._v("JavaScript Date 객체는 내부적으로 Milliseconds Unix Time을 사용하지만 항상 LocalTime으로 표시된다.\n그것을, 주어진 timezone 옵션에 맞춰서 컨버팅 하는 것이며 Database에서 가져올때는 그 반대를 적용한다.")]),t._v(" "),e("p",[t._v("이 과정은 드라이버의 "),e("code",[t._v("typeCast")]),t._v(" 옵션을 사용해서 추가 구현할 수도 있다.")]),t._v(" "),e("p",[e("code",[t._v("typeCast")]),t._v(" 옵션은 기본적으로 컬럼 값을 Native JavaScript type으로 변환할지 선택하는 옵션으로 두 드라이버 모두 기본값은 "),e("code",[t._v("true")]),t._v("이다.")]),t._v(" "),e("p",[t._v("옵션값으로 함수를 설정하면 사용자 정의 타입변환을 추가 적용할 수 있다.")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("mysqljs")]),t._v(": "),e("code",[t._v("mysql/lib/protocol/packets/RowDataPacket.js")])]),t._v(" "),e("li",[e("code",[t._v("node-mysql2")]),t._v(": "),e("code",[t._v("node-mysql2/lib/parsers/text_parser.js")])])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("typeCast")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("field"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("field"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DATETIME'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token template-string"}},[e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("field"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("Z")]),e("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// can be 'Z' for UTC or an offset in the form '+HH:MM' or '-HH:MM'")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")])]),e("p",[t._v("데이터를 UTC로 관리하려면 다음 설정을 사용하면 된다 (타임존 처리는 Application 위임)")]),t._v(" "),e("ul",[e("li",[t._v("set node-mysql driver's timezone option to "),e("code",[t._v("'+0'")]),t._v(" or "),e("code",[t._v("'+00:00'")]),t._v(" or "),e("code",[t._v("'Z'")])]),t._v(" "),e("li",[t._v("run the DBMS with the timezone environment variable "),e("code",[t._v("TZ=UTC")])])]),t._v(" "),e("h3",{attrs:{id:"timezone-테스트"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#timezone-테스트"}},[t._v("#")]),t._v(" timezone 테스트")]),t._v(" "),e("blockquote",[e("p",[t._v("실행시각 2023-03-01 10:35:40+09")])]),t._v(" "),e("p",[t._v("driver option: "),e("code",[t._v("timezone: 'local'")])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("입력 system_tz: UTC")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("datetime (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 10:35:40 (UTC)")]),t._v(" "),e("li",[t._v("2023-03-01 10:35:40 (KST) *")])])]),t._v(" "),e("li",[e("p",[t._v("timestamp (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 10:35:40 (UTC)")]),t._v(" "),e("li",[t._v("2023-03-01 19:35:40 (KST)")])])])])]),t._v(" "),e("li",[e("p",[t._v("입력 system_tz: KST")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("datetime (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 10:35:40 (UTC)")]),t._v(" "),e("li",[t._v("2023-03-01 10:35:40 (KST) *")])])]),t._v(" "),e("li",[e("p",[t._v("timestamp (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 01:35:40 (UTC) *")]),t._v(" "),e("li",[t._v("2023-03-01 10:35:40 (KST) *")])])])])])]),t._v(" "),e("p",[t._v("driver option: "),e("code",[t._v("timezone: 'z'")])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("입력 system_tz: UTC")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("datetime (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 01:35:40 (UTC) *")]),t._v(" "),e("li",[t._v("2023-03-01 01:35:40 (KST)")])])]),t._v(" "),e("li",[e("p",[t._v("timestamp (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 01:35:40 (UTC) *")]),t._v(" "),e("li",[t._v("2023-03-01 10:35:40 (KST) *")])])])])]),t._v(" "),e("li",[e("p",[t._v("입력 system_tz: KST")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("datetime (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-03-01 01:35:40 (UTC) *")]),t._v(" "),e("li",[t._v("2023-03-01 01:35:40 (KST)")])])]),t._v(" "),e("li",[e("p",[t._v("timestamp (조회 session_tz)")]),t._v(" "),e("ul",[e("li",[t._v("2023-02-28 16:35:40 (UTC)")]),t._v(" "),e("li",[t._v("2023-03-01 01:35:40 (KST)")])])])])])]),t._v(" "),e("blockquote",[e("p",[e("strong",[t._v("datetime")]),t._v(" 타입은 타임존에 맞춰 변환하지 않기 때문에 값을 입력할 때 DBMS의 타임존 설정을 신경 쓸 필요가 없다.\n그러나 여러 지역에 서비스가 분산되어 있다면, DB에 datetime 값을 입력할 때 app에서 보낸 값을 그대로 사용할 것이므로\n저장된 값의 타임존이 각자 달라서 같은 시간에 다른 값이 저장되지만 타임존 정보가 없으므로 정보유실이 발생하게 된다.\n따라서, driver(client) 설정은 항상 UTC로 하는 것이 좋을 것 같다 (이렇게 하면 DB에 저장된 datetime 값은 항상 UTC임)")]),t._v(" "),e("p",[e("strong",[t._v("timestamp")]),t._v(" 타입은 입력할 때 DBMS의 타임존과 driver(client) 타임존을 맞춰야 다른 타임존으로 조회했을때 정상값이 출력된다.\n실수를 방지하기 위해서 datetime과 마찬가지로 모든 설정을 UTC기준으로만 사용하는 것이 좋을 것 같다.")])]),t._v(" "),e("h2",{attrs:{id:"에러처리"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#에러처리"}},[t._v("#")]),t._v(" 에러처리")]),t._v(" "),e("ul",[e("li",[t._v("에러코드: "),e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2/blob/master/lib/constants/errors.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2/blob/master/lib/constants/errors.js"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("에러패킷처리 (저수준): "),e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2/blob/092dc7f103f622b0c9d013b286cea48ed01883a9/lib/packets/packet.js#L718",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2/blob/092dc7f103f622b0c9d013b286cea48ed01883a9/lib/packets/packet.js#L718"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("에러처리 (고수준): "),e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2/blob/092dc7f103f622b0c9d013b286cea48ed01883a9/promise.js#L7",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2/blob/092dc7f103f622b0c9d013b286cea48ed01883a9/promise.js#L7"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"mysqljs-vs-node-mysql2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysqljs-vs-node-mysql2"}},[t._v("#")]),t._v(" mysqljs vs node-mysql2")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2/tree/master/documentation#known-incompatibilities-with-node-mysql",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2/tree/master/documentation#known-incompatibilities-with-node-mysql"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"zerofill"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zerofill"}},[t._v("#")]),t._v(" zeroFill")]),t._v(" "),e("p",[e("code",[t._v("zeroFill")]),t._v(" flag is ignored in type conversion.\nYou need to check corresponding field's zeroFill flag and convert to string manually if this is of importance to you.")]),t._v(" "),e("h3",{attrs:{id:"decimal-and-newdecimal"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#decimal-and-newdecimal"}},[t._v("#")]),t._v(" DECIMAL and NEWDECIMAL")]),t._v(" "),e("p",[t._v("mysql의 집계함수 결과값은 DECIMAL/DOUBLE로 출력되는데, 두 드라이버의 처리방식이 다르다.")]),t._v(" "),e("blockquote",[e("p",[t._v("DECIMAL and NEWDECIMAL types always returned as string unless you pass this config option")])]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  decimalNumbers"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("h2",{attrs:{id:"issues-in-node-mysql2-with-jest"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#issues-in-node-mysql2-with-jest"}},[t._v("#")]),t._v(" issues in node-mysql2 with Jest")]),t._v(" "),e("h3",{attrs:{id:"encoding-not-recognized"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#encoding-not-recognized"}},[t._v("#")]),t._v(" "),e("code",[t._v("Encoding not recognized")])]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2/issues/489",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2/issues/489"),e("OutboundLink")],1)]),t._v(" "),e("blockquote",[e("p",[t._v("다음 인코딩 불러오기 코드를 database connection 생성 코드 상단에 입력한다")])]),t._v(" "),e("p",[t._v("JavaScript")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iconv-lite'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodingExists")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cesu8'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("TypeScript")]),t._v(" "),e("div",{staticClass:"language-ts line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-ts"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" iconv "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iconv-lite'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\niconv"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodingExists")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cesu8'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("h2",{attrs:{id:"쿼리결과-스트림-처리"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#쿼리결과-스트림-처리"}},[t._v("#")]),t._v(" 쿼리결과 스트림 처리")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/sidorares/node-mysql2/issues/677",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/sidorares/node-mysql2/issues/677"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);