(window.webpackJsonp=window.webpackJsonp||[]).push([[231],{598:function(e,t,s){"use strict";s.r(t);var a=s(28),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"public-key-infrastructure"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#public-key-infrastructure"}},[e._v("#")]),e._v(" Public Key Infrastructure")]),e._v(" "),s("h2",{attrs:{id:"pkcs-public-key-cryptography-standards"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-public-key-cryptography-standards"}},[e._v("#")]),e._v(" PKCS (public-key cryptography standards)")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/PKCS",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/PKCS"),s("OutboundLink")],1)]),e._v(" "),s("blockquote",[s("p",[e._v("암호화 알고리즘 목록 출력: "),s("code",[e._v("openssl enc --list")])])]),e._v(" "),s("h3",{attrs:{id:"pkcs-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-1"}},[e._v("#")]),e._v(" PKCS#1")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/PKCS_1",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/PKCS_1"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc8017",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://datatracker.ietf.org/doc/html/rfc8017"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("RSA 암호표준이며 공개키와 비밀키(ASN.1) 규격, 암복호화/서명에 필요한 알고리즘과 인코딩 등을 정의한다")]),e._v(" "),s("p",[e._v("PEM 형식인 경우 헤더는 다음과 같다")]),e._v(" "),s("ul",[s("li",[e._v("비밀키: "),s("code",[e._v("-----BEGIN RSA PRIVATE KEY-----")])]),e._v(" "),s("li",[e._v("공개키: "),s("code",[e._v("-----BEGIN RSA PUBLIC KEY-----")])])]),e._v(" "),s("h3",{attrs:{id:"pkcs-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-8"}},[e._v("#")]),e._v(" PKCS#8")]),e._v(" "),s("p",[e._v("개인키 포맷 표준이며 PEM 형식인 경우 헤더는 다음과 같다")]),e._v(" "),s("ul",[s("li",[e._v("암호화된 경우: "),s("code",[e._v("-----BEGIN ENCRYPTED PRIVATE KEY----")])]),e._v(" "),s("li",[e._v("암호화되지 않은 경우: "),s("code",[e._v("-----BEGIN PRIVATE KEY----")])])]),e._v(" "),s("p",[e._v("암호화된 경우 본문은 두 개의 Sequence로 구성되어 있다")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc5208#section-6",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://datatracker.ietf.org/doc/html/rfc5208#section-6"),s("OutboundLink")],1)]),e._v(" "),s("ul",[s("li",[s("code",[e._v("EncryptionAlgorithmIdentifier")]),e._v(": 암호화 알고리즘 Identifier(OID)")]),e._v(" "),s("li",[s("code",[e._v("EncryptedData")]),e._v(": 암호화된 개인키")])]),e._v(" "),s("div",{staticClass:"language-asn1 line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("EncryptedPrivateKeyInfo ::= SEQUENCE {\n  encryptionAlgorithm  EncryptionAlgorithmIdentifier,\n  encryptedData        EncryptedData\n}\n\nEncryptionAlgorithmIdentifier ::= SEQUENCE {\n  algorithm       OBJECT IDENTIFIER,\n  parameters      ANY DEFINED BY algorithm OPTIONAL\n}\n\nEncryptedData ::= OCTET STRING\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("암호화되지 않은 경우 다음의 Sequence로 구성되어 있다")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc5208#section-5",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://datatracker.ietf.org/doc/html/rfc5208#section-5"),s("OutboundLink")],1)]),e._v(" "),s("div",{staticClass:"language-asn1 line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PrivateKeyInfo ::= SEQUENCE {\n  version                   Version,\n  privateKeyAlgorithm       PrivateKeyAlgorithmIdentifier,\n  privateKey                PrivateKey,\n  attributes           [0]  IMPLICIT Attributes OPTIONAL\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("blockquote",[s("p",[s("code",[e._v("AlgorithmIdentifier")]),e._v(": "),s("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.1.2",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://datatracker.ietf.org/doc/html/rfc5280#section-4.1.1.2"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("mono(.NET opensource) 구현체 (C#)")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/mono/mono/blob/main/mcs/class/Mono.Security/Mono.Security.Cryptography/PKCS8.cs",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/mono/mono/blob/main/mcs/class/Mono.Security/Mono.Security.Cryptography/PKCS8.cs"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("BouncyCastle 구현체 (Java)")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/bcgit/bc-java/blob/master/jce/src/main/java/javax/crypto/EncryptedPrivateKeyInfo.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/bcgit/bc-java/blob/master/jce/src/main/java/javax/crypto/EncryptedPrivateKeyInfo.java"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/bcgit/bc-java/blob/master/core/src/main/java/org/bouncycastle/asn1/pkcs/EncryptedPrivateKeyInfo.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/bcgit/bc-java/blob/master/core/src/main/java/org/bouncycastle/asn1/pkcs/EncryptedPrivateKeyInfo.java"),s("OutboundLink")],1)])]),e._v(" "),s("h3",{attrs:{id:"pkcs-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-7"}},[e._v("#")]),e._v(" PKCS#7")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/PKCS_7",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/PKCS_7"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("공인인증서 역시 PKCS#7 표준에 따라 개인키를 사용해 서명한 내용을 공개키와 함께 배포하면 해당 내용의 소유권을 인증할 수 있다")]),e._v(" "),s("p",[e._v("또한 상위기관에서 서명한 CRL(Certificate Revocation List, 인증서 폐기 목록)을 확인하는 용도로도 사용된다.")]),e._v(" "),s("p",[e._v("CRL을 사용한 인증서 검증과정은 다음과 같다")]),e._v(" "),s("ul",[s("li",[e._v("인증서의 일련번호")]),e._v(" "),s("li",[e._v("인증서 CRL Distribution Points 확인")]),e._v(" "),s("li",[e._v("CRL 서명 검증")]),e._v(" "),s("li",[e._v("CRL 내용에서 인증서 일련번호 검색")])]),e._v(" "),s("h2",{attrs:{id:"asn-1-abstract-syntax-notation-one"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#asn-1-abstract-syntax-notation-one"}},[e._v("#")]),e._v(" ASN.1 (Abstract Syntax Notation One)")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/ASN.1",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/ASN.1"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.690",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/X.690"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://letsencrypt.org/docs/a-warm-welcome-to-asn1-and-der/"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("ASN.1은 직렬화/역직렬화 하여 크래스플랫폼에서 사용가능한 추상 구문 구조를 기술하는 표준 인터페이스 표현 언어이다")]),e._v(" "),s("p",[e._v("ASN.1은 X.609 표준에 서술된 BER(Basic Encoding Rules), CER(Canonical Encoding Rules), DER(Distinguished Encoding Rules) 형식으로 인코딩하여 사용한다.")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.690#BER,_CER_and_DER_compared",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/X.690#BER,_CER_and_DER_compared"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("PKCS 및 X.509 표준에 사용되는 문법이다")]),e._v(" "),s("h2",{attrs:{id:"pki-인증서-구조"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pki-인증서-구조"}},[e._v("#")]),e._v(" PKI 인증서 구조")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/X.509",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/X.509"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://ko.wikipedia.org/wiki/X.509",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://ko.wikipedia.org/wiki/X.509"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://datatracker.ietf.org/doc/html/rfc5280",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://datatracker.ietf.org/doc/html/rfc5280"),s("OutboundLink")],1)])]),e._v(" "),s("p",[e._v("X.509는 공개키 기반(PKI) 인증구조의 ITU-T 표준이다")]),e._v(" "),s("h3",{attrs:{id:"root-ca-certificate-authorities"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#root-ca-certificate-authorities"}},[e._v("#")]),e._v(" Root CA (certificate authorities)")]),e._v(" "),s("p",[e._v("최상위 인증기관")]),e._v(" "),s("h3",{attrs:{id:"intermediate-certificate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#intermediate-certificate"}},[e._v("#")]),e._v(" Intermediate certificate")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Chain_of_trust",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/Chain_of_trust"),s("OutboundLink")],1)]),e._v(" "),s("blockquote",[s("p",[e._v("Root CA는 이름 그대로 인증서 신뢰 관계의 원점(Trust anchor)이기 때문에 Root CA가 훼손될 경우 신뢰 구조 전체가 무너지게 됩니다.\n따라서 네트워크에서 분리된(Air Gapped 또는 오프라인) 환경에서 안전하게 관리되어야 합니다(이런 부분이 잘 관리되고 있는지 검증받아야 CA가 될 수 있기도 합니다).\n이렇게 Root CA는 중간 CA를 발급(서명)하는 경우에만 제한적으로 사용되고,\nRoot CA를 이용해 발급한 중간 CA만 시스템 상에 온라인으로 두고 Leaf 인증서 발급(서명)에 사용하는 위와 같은 구조가 되는 것입니다.")])]),e._v(" "),s("p",[e._v("from: "),s("a",{attrs:{href:"https://engineering.linecorp.com/ko/blog/best-practices-to-secure-your-ssl-tls/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://engineering.linecorp.com/ko/blog/best-practices-to-secure-your-ssl-tls/"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("Root CA의 경우 브라우저나 기본 KeyStore에 포함되어 있다.\n하지만 Intermediate Certificate는 포함되지 않을 수 있으므로 TLS 제공자의 서버에서 제공해야 한다.")]),e._v(" "),s("h3",{attrs:{id:"domain-certificate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#domain-certificate"}},[e._v("#")]),e._v(" Domain certificate")]),e._v(" "),s("blockquote",[s("p",[e._v("CA로 부터 인증을 받을 수 있다, Https 인증서는 Domain 인증이지만 공인인증서라면 개인인증서에 해당한다")])]),e._v(" "),s("p",[e._v("예를 들어, Let’s Encrypt 경우 인증을 받으면 다음 파일들이 생성된다")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("privkey.pem")]),e._v(": 도메인 인증서의 개인키")]),e._v(" "),s("li",[s("code",[e._v("cert.pem")]),e._v(": 서명된 도메인 인증서")])]),e._v(" "),s("p",[e._v("CA 정보를 담은 파일도 함께 생성된다")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("chain.pem")]),e._v(": Let’s Encrypt의 중간 인증서(intermediate certificate)")]),e._v(" "),s("li",[s("code",[e._v("fullchain.pem")]),e._v(": "),s("code",[e._v("cert + chain")])])]),e._v(" "),s("h2",{attrs:{id:"two-way-ssl-communication"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#two-way-ssl-communication"}},[e._v("#")]),e._v(" Two-way SSL communication")]),e._v(" "),s("p",[e._v("클라이언트 인증이라고도 불린다")]),e._v(" "),s("ul",[s("li",[e._v("클라이언트의 인증서와 서버의 인증서를 각각 생성")]),e._v(" "),s("li",[e._v("클라이언트와 서버 각각에서 신뢰할 수 있는 CA에 상호의 인증서를 추가")]),e._v(" "),s("li",[e._v("양쪽 모두가 신뢰할 수 있는 상황이 아니면 연결을 거부")])]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.ibm.com/support/knowledgecenter/SSRMWJ_7.0.1.13/com.ibm.isim.doc/securing/cpt/cpt_ic_security_ssl_scenario.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.ibm.com/support/knowledgecenter/SSRMWJ_7.0.1.13/com.ibm.isim.doc/securing/cpt/cpt_ic_security_ssl_scenario.html"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"self-signed-certificate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#self-signed-certificate"}},[e._v("#")]),e._v(" Self-signed Certificate")]),e._v(" "),s("p",[e._v("OpenSSL을 사용하여 Self Signed Certificate를 생성할 수 있다.")]),e._v(" "),s("h3",{attrs:{id:"self-signed-root-ca"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#self-signed-root-ca"}},[e._v("#")]),e._v(" Self-signed Root CA")]),e._v(" "),s("p",[e._v("Root CA의 개인키를 생성한다: "),s("code",[e._v("openssl genrsa -aes256 -out root-ca.key 2048")])]),e._v(" "),s("p",[e._v("CSR로 Root CA 인증서 생성: "),s("code",[e._v("openssl req -x509 -new -nodes -key root-ca.key -sha256 -days 1825 -out root-ca.crt")])]),e._v(" "),s("p",[e._v("대화형으로 진행됨")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("Enter pass phrase "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" myCA.key:\n-----\nCountry Name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" letter code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nState or Province Name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("full name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nLocality Name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("eg, city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nOrganization Name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("eg, company"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nOrganizational Unit Name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("eg, section"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nCommon Name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("e.g. server FQDN or YOUR name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nEmail Address\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("h3",{attrs:{id:"self-signed-ca-signed-cert"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#self-signed-ca-signed-cert"}},[e._v("#")]),e._v(" Self-signed CA-signed Cert")]),e._v(" "),s("p",[e._v("서버 비밀키 생성: "),s("code",[e._v("openssl genrsa -out myserver.key 2048")])]),e._v(" "),s("p",[e._v("CSR 생성(대화형으로 진행됨): "),s("code",[e._v("openssl req -new -key myserver.key -out myserver.csr")])]),e._v(" "),s("p",[e._v("CSR 검증: "),s("code",[e._v("openssl req -in myserver.csr -noout -text")])]),e._v(" "),s("h4",{attrs:{id:"서버-인증서-생성-fdqn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#서버-인증서-생성-fdqn"}},[e._v("#")]),e._v(" 서버 인증서 생성: FDQN")]),e._v(" "),s("p",[e._v("Fully Qualified Domain Name (FDQN): 기존의 고유이름 방식 ("),s("code",[e._v("[hostname].[domain].[tld]")]),e._v(")")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("openssl x509 -req -in myserver.csr -CA root-ca.crt -CAkey root-ca.key -CAcreateserial "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  -out myserver.crt -days "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1825")]),e._v(" -sha256\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("h4",{attrs:{id:"서버-인증서-생성-san"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#서버-인증서-생성-san"}},[e._v("#")]),e._v(" 서버 인증서 생성: SAN")]),e._v(" "),s("p",[e._v("Subject Alternative Name (SAN): 멀티 도메인 인증을 위한 방식")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("openssl x509 -req -in myserver.csr -CA root-ca.crt -CAkey root-ca.key -CAcreateserial "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  -extfile "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("printf")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"subjectAltName=DNS:example.com,DNS:example.net,IP:10.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  -out myserver.crt -days "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1825")]),e._v(" -sha256\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"검증"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#검증"}},[e._v("#")]),e._v(" 검증")]),e._v(" "),s("p",[s("code",[e._v("openssl x509 -in myserver.crt -text -noout")])]),e._v(" "),s("h3",{attrs:{id:"통신"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#통신"}},[e._v("#")]),e._v(" 통신")]),e._v(" "),s("p",[e._v("자체서명 인증서 과정에서 다음파일들이 생성된다")]),e._v(" "),s("ul",[s("li",[e._v("root CA 비밀키")]),e._v(" "),s("li",[e._v("root CA 인증서")]),e._v(" "),s("li",[e._v("서버 개인키")]),e._v(" "),s("li",[e._v("서버 인증서")])]),e._v(" "),s("p",[e._v("서버에서는 다음 파일을 가지고 클라이언트 요청을 받는다")]),e._v(" "),s("ul",[s("li",[e._v("서버 개인키")]),e._v(" "),s("li",[e._v("서버 인증서")])]),e._v(" "),s("blockquote",[s("p",[e._v("자체 서명은 사설 root CA 직접 서명이므로 인증서 chain은 필요없다")])]),e._v(" "),s("p",[e._v("클라이언트는 다음 파일을 가지고 자체서명 인증서를 사용하는 서버에 요청한다")]),e._v(" "),s("ul",[s("li",[e._v("root CA 인증서")])]),e._v(" "),s("p",[e._v("또는 클라이언트에서 "),s("code",[e._v("rejectUnauthorized = false")]),e._v("를 사용할 수도 있다 (인증서 검증하지 않음)")]),e._v(" "),s("h2",{attrs:{id:"인증서-형식"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#인증서-형식"}},[e._v("#")]),e._v(" 인증서 형식")]),e._v(" "),s("h3",{attrs:{id:"인증서-인코딩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#인증서-인코딩"}},[e._v("#")]),e._v(" 인증서 인코딩")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.ssl.com/guide/pem-der-crt-and-cer-x-509-encodings-and-conversions/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.ssl.com/guide/pem-der-crt-and-cer-x-509-encodings-and-conversions/"),s("OutboundLink")],1)]),e._v(" "),s("h4",{attrs:{id:"pem-privacy-enhanced-mail"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pem-privacy-enhanced-mail"}},[e._v("#")]),e._v(" "),s("code",[e._v("PEM")]),e._v(" (Privacy Enhanced Mail)")]),e._v(" "),s("p",[e._v("본문은 Base64 ASCII 인코딩 되어 있으며, 첫 줄과 마지막 줄(헤더, 푸터)은 어떤 종류의 데이터인지 표시한다")]),e._v(" "),s("div",{staticClass:"language-txt line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[e._v("-----BEGIN *****-----\nBASE64 ENCODED TEXT\n-----END *****_____\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h4",{attrs:{id:"binary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#binary"}},[e._v("#")]),e._v(" BINARY")]),e._v(" "),s("p",[e._v("X.609(BER, CER, DER) 인코딩된 바이너리(이진) 데이터이다")]),e._v(" "),s("h3",{attrs:{id:"인증서-파일-확장자"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#인증서-파일-확장자"}},[e._v("#")]),e._v(" 인증서 파일 확장자")]),e._v(" "),s("h4",{attrs:{id:"pem"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pem"}},[e._v("#")]),e._v(" "),s("code",[e._v(".pem")])]),e._v(" "),s("p",[s("strong",[e._v("PEM")]),e._v(" 형식으로 되어있는 파일이며 어떠한 인증서 관련 파일인지는 내용을 확인해 보아야 한다")]),e._v(" "),s("h4",{attrs:{id:"crt-or-cer-certificate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#crt-or-cer-certificate"}},[e._v("#")]),e._v(" "),s("code",[e._v(".crt")]),e._v(" or "),s("code",[e._v(".cer")]),e._v(" (Certificate)")]),e._v(" "),s("p",[e._v("일반적으로 인증서 파일의 확장자로 많이 쓰이고 주로 "),s("strong",[e._v("PEM")]),e._v(" 형식으로 되어있다.\nunix 계열에서는 주로 "),s("code",[e._v("crt")]),e._v(", 윈도우즈에서는 "),s("code",[e._v("cer")]),e._v(" 확장자를 사용한다")]),e._v(" "),s("p",[e._v("PEM 인증서인 경우 "),s("code",[e._v("-----BEGIN CERTIFICATE-----")]),e._v(" 헤더로 시작한다")]),e._v(" "),s("h4",{attrs:{id:"csr-certificate-signing-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#csr-certificate-signing-request"}},[e._v("#")]),e._v(" "),s("code",[e._v(".csr")]),e._v(" (Certificate Signing Request)")]),e._v(" "),s("p",[e._v("인증서 발급 신청을 위해 CA에 요청할 내용이 담겨 있는 파일이며 주로 "),s("strong",[e._v("PEM")]),e._v(" 형식으로 되어있다.")]),e._v(" "),s("p",[e._v("PEM 인증서인 경우 "),s("code",[e._v("-----BEGIN NEW CERTIFICATE REQUEST-----")]),e._v(" 헤더로 시작한다")]),e._v(" "),s("h4",{attrs:{id:"key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#key"}},[e._v("#")]),e._v(" "),s("code",[e._v(".key")])]),e._v(" "),s("p",[e._v("일반적으로 개인키 파일에 사용하는 확장자이다(공개키에 쓸 수도 있다...). 주로 "),s("strong",[e._v("PEM")]),e._v(" 형식으로 되어 있으나, 바이너리 형식일 수도 있다")]),e._v(" "),s("h4",{attrs:{id:"pfx-or-p12-pkcs-12"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pfx-or-p12-pkcs-12"}},[e._v("#")]),e._v(" "),s("code",[e._v(".pfx")]),e._v(" or "),s("code",[e._v(".p12")]),e._v(" (PKCS#12)")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://en.wikipedia.org/wiki/PKCS_12",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://en.wikipedia.org/wiki/PKCS_12"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("일반적으로 X.509 인증서와 개인키를 (혹은 다수의 묶음을) 하나의 파일에 포함한 "),s("strong",[e._v("바이너리")]),e._v(" 형식의 "),s("em",[e._v("archive file format")]),e._v(" 이다.")]),e._v(" "),s("p",[e._v('PKCS#12 역시 서명하고 암호화 할 수 있으며 이 경우 "SafeBags"라 불린다.')]),e._v(" "),s("h4",{attrs:{id:"jks-java-key-store"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jks-java-key-store"}},[e._v("#")]),e._v(" "),s("code",[e._v(".jks")]),e._v(" (Java Key Store)")]),e._v(" "),s("p",[e._v("일종의 자바에서 사용하는 "),s("em",[e._v("p12")]),e._v(" 포맷이지만 다른 시스템과 호환성은 없다. 자바9 이후로는 PKCS#12 포맷이 기본이 되었다.")]),e._v(" "),s("h2",{attrs:{id:"비대칭-키-생성-openssl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#비대칭-키-생성-openssl"}},[e._v("#")]),e._v(" 비대칭 키 생성 (openssl)")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.openssl.org/docs/manpages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.openssl.org/docs/manpages.html"),s("OutboundLink")],1)]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# private key")]),e._v("\nopenssl genrsa -out private.pem "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2048")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# private key with cipher")]),e._v("\nopenssl genrsa -aes-256-cbc -out private.pem "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2048")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# public key")]),e._v("\nopenssl rsa -in private.pem -out public.pem -pubout\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h2",{attrs:{id:"인증서-인코딩-변환"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#인증서-인코딩-변환"}},[e._v("#")]),e._v(" 인증서 인코딩 변환")]),e._v(" "),s("h3",{attrs:{id:"pem-바이너리-der"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pem-바이너리-der"}},[e._v("#")]),e._v(" PEM -> 바이너리(DER)")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 인증서 변환")]),e._v("\nopenssl x509 -in cert.pem -out cert.der -outform der\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 개인키 변환 (암호화 파일은 암호 입력후 복호화 출력됨 -> 다시 암호화 필요)")]),e._v("\nopenssl rsa -in priv.pem -out priv.key -outform der\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h3",{attrs:{id:"바이너리-der-pem"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#바이너리-der-pem"}},[e._v("#")]),e._v(" 바이너리(DER) -> PEM")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 인증서 변환")]),e._v("\nopenssl x509 -in cert.der -inform der -out cert.pem\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 개인키 변환 (암호화 파일은 암호 입력후 복호화 출력됨 -> 다시 암호화 필요)")]),e._v("\nopenssl rsa -in priv.key -inform der -out priv.pem\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h2",{attrs:{id:"인증서-유형-변환"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#인증서-유형-변환"}},[e._v("#")]),e._v(" 인증서 유형 변환")]),e._v(" "),s("h3",{attrs:{id:"개인키-pkcs-8"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#개인키-pkcs-8"}},[e._v("#")]),e._v(" 개인키 -> PKCS#8")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Convert a private key to PKCS#8 format using default parameters (AES with 256 bit key and hmacWithSHA256)")]),e._v("\nopenssl pkcs8 -in private.pem -topk8 -out private.key\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("h3",{attrs:{id:"pkcs-8-pkcs-1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-8-pkcs-1"}},[e._v("#")]),e._v(" PKCS#8 -> PKCS#1")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("openssl rsa -in pkcs8.pem -out pkcs1.pem\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("h3",{attrs:{id:"pkcs-12-pem"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-12-pem"}},[e._v("#")]),e._v(" PKCS#12 -> PEM")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 인증서 추출")]),e._v("\nopenssl pkcs12 -in cert.p12 -out cert.pem -clcerts -nokeys\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 복호화된 개인키 추출")]),e._v("\nopenssl pkcs12 -in cert.p12 -out pri.pem -nocerts -nodes\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 암호화된 개인키 추출")]),e._v("\nopenssl pkcs12 -in cert.p12 -out encPri.pem -nocerts\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 개인키 복호화")]),e._v("\nopenssl rsa -in encPri.pem -out pri.pem\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("h3",{attrs:{id:"pem-pkcs-12"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pem-pkcs-12"}},[e._v("#")]),e._v(" PEM -> PKCS#12")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# cert.pem 파일로 통합 (full-chain)")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" domain.crt chain1.crt chain2.crt root.crt "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" cert.pem\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# .pfx/.p12 파일로 저장 (cert + privkey)")]),e._v("\nopenssl pkcs12 -export -out unified.p12 -in cert.pem -inkey priv.key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("-name example.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("-certfile root-chain.cer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h3",{attrs:{id:"pkcs-12-jks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pkcs-12-jks"}},[e._v("#")]),e._v(" PKCS#12 -> JKS")]),e._v(" "),s("p",[s("code",[e._v("keytool -importkeystore -srckeystore unified.p12 -srcstoretype pkcs12 -destkeystore unified.jks -deststoretype jks")])]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("대상 키 저장소 비밀번호 입력: ******\n새 비밀번호 다시 입력: ******\n소스 키 저장소 비밀번호 입력: ****** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("pfx 생성시 지정한 암호"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("blockquote",[s("p",[s("a",{attrs:{href:"https://www.securesign.kr/guides/SSL-Certificate-Convert-Format",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.securesign.kr/guides/SSL-Certificate-Convert-Format"),s("OutboundLink")],1)])]),e._v(" "),s("h4",{attrs:{id:"jks-오류-cannot-recover-key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jks-오류-cannot-recover-key"}},[e._v("#")]),e._v(" jks 오류 (Cannot recover key)")]),e._v(" "),s("blockquote",[s("p",[e._v("Solution: The KeyStore password and The Key password should be the same.")])]),e._v(" "),s("p",[e._v("Changing both passwords using keytool")]),e._v(" "),s("p",[e._v("Change KeyStore password")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("keytool -storepasswd -new %newpassword% -keystore %YourKeyStore%.jks\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# replace %newpassword% with your actual password, same with YourKeyStore")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("Change Alias key Password")]),e._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("keytool -keypasswd -alias %MyKeyAlias% -new %newpassword% -keystore KeyStore.jks\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Note: supply old passwords for both keystore and alias when asked for them")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[s("a",{attrs:{href:"https://stackoverflow.com/questions/14606837/cannot-recover-key",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://stackoverflow.com/questions/14606837/cannot-recover-key"),s("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);