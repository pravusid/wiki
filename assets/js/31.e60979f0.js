(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{402:function(t,o,e){"use strict";e.r(o);var n=e(28),v=Object(n.a)({},(function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"innodb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#innodb"}},[t._v("#")]),t._v(" InnoDB")]),t._v(" "),e("h2",{attrs:{id:"innodb-lock"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#innodb-lock"}},[t._v("#")]),t._v(" InnoDB Lock")]),t._v(" "),e("h3",{attrs:{id:"lock-개요"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lock-개요"}},[t._v("#")]),t._v(" Lock 개요")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html"),e("OutboundLink")],1)]),t._v(" "),e("ul",[e("li",[t._v("공유 (S) 락은 트랜잭션에게 레코드 읽기를 허용한다")]),t._v(" "),e("li",[t._v("배타적 (X) 락은 트랜잭션에게 레코드 업데이트 또는 삭제를 허용한다")])]),t._v(" "),e("p",[t._v("인텐션은 테이블에 있는 행에 대해서 나중에 요청되는 것이 어떤 형태의 락(S/X)인지를 나타내는 테이블 수준의 잠금이다.\nInnoDB에서는 두 가지 타입의 인텐션 락이 사용된다 (트랜잭션 T는 테이블 R에서 가리키는 타입에 대해서 요청되는 락을 가지고 있다)")]),t._v(" "),e("ul",[e("li",[t._v("인텐션 공유 (IS): 트랜잭션 T는 테이블 R에 있는 개별적인 열에 S 락을 설정하려고 한다.")]),t._v(" "),e("li",[t._v("인텐션 배타적 (IX): 트랜잭션 T는 이러한 열에 대해서 X 락을 설정하려고 한다.")])]),t._v(" "),e("p",[t._v("인텐션락 프로토콜은 다음과 같다")]),t._v(" "),e("ul",[e("li",[t._v("트랜잭션에서 레코드에 대한 S 락을 얻기위해, 테이블에 대해 IS 락 혹은 더 강한 락 권한을 얻어야 한다")]),t._v(" "),e("li",[t._v("트랜잭션에서 레코드에 대한 X 락을 얻기위해, 테이블에 대해 IX 락을 얻어야 한다")])]),t._v(" "),e("blockquote",[e("p",[e("code",[t._v("IS")]),t._v(", "),e("code",[t._v("IX")]),t._v(" 락은 여러 트랜잭션에서 동시에 접근이 가능하다 (접근 순서를 획득한다)")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th"),t._v(" "),e("th",[t._v("X")]),t._v(" "),e("th",[t._v("IX")]),t._v(" "),e("th",[t._v("S")]),t._v(" "),e("th",[t._v("IS")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("X")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Conflict")])]),t._v(" "),e("tr",[e("td",[t._v("IX")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Compatible")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Compatible")])]),t._v(" "),e("tr",[e("td",[t._v("S")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Compatible")]),t._v(" "),e("td",[t._v("Compatible")])]),t._v(" "),e("tr",[e("td",[t._v("IS")]),t._v(" "),e("td",[t._v("Conflict")]),t._v(" "),e("td",[t._v("Compatible")]),t._v(" "),e("td",[t._v("Compatible")]),t._v(" "),e("td",[t._v("Compatible")])])])]),t._v(" "),e("h3",{attrs:{id:"lock-유형"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lock-유형"}},[t._v("#")]),t._v(" Lock 유형")]),t._v(" "),e("ul",[e("li",[t._v("Record Locks")]),t._v(" "),e("li",[t._v("Gap Locks")]),t._v(" "),e("li",[t._v("Next-Key Locks")]),t._v(" "),e("li",[t._v("Insert Intention Locks")]),t._v(" "),e("li",[t._v("AUTO-INC Locks")]),t._v(" "),e("li",[t._v("Predicate Locks for Spatial Indexes")])]),t._v(" "),e("h3",{attrs:{id:"상황별-lock-설정"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#상황별-lock-설정"}},[t._v("#")]),t._v(" 상황별 Lock 설정")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"존재하지-않는행-select-for-update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#존재하지-않는행-select-for-update"}},[t._v("#")]),t._v(" 존재하지 않는행 "),e("code",[t._v("SELECT... FOR UPDATE")])]),t._v(" "),e("p",[t._v("TL;DR")]),t._v(" "),e("p",[t._v("InnoDB "),e("code",[t._v("FOR UPDATE")]),t._v(" 잠금은 row 단위 인데(unique 조건) 만약 행이 존재하지 않는다면\n해당 테이블에 "),e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html#innodb-next-key-locks",target:"_blank",rel:"noopener noreferrer"}},[t._v("next-key-locks"),e("OutboundLink")],1),t._v(" 적용 될 수 있음")]),t._v(" "),e("p",[t._v("또한 존재하지 않는 행에 대해 "),e("code",[t._v("SELECT... FOR UPDATE")]),t._v(" 여러 트랜잭션이 동시에 요청을 하면, 명확한 lock 대상이 없으므로 deadlock 발생가능")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://mysqlquicksand.wordpress.com/2019/12/20/select-for-update-on-non-existent-rows/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://mysqlquicksand.wordpress.com/2019/12/20/select-for-update-on-non-existent-rows/"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://fastmail.blog/2017/12/09/mysql-lock-nonexistent-row/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fastmail.blog/2017/12/09/mysql-lock-nonexistent-row/"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://stackoverflow.com/questions/17068686/how-do-i-lock-on-an-innodb-row-that-doesnt-exist-yet",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://stackoverflow.com/questions/17068686/how-do-i-lock-on-an-innodb-row-that-doesnt-exist-yet"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);o.default=v.exports}}]);